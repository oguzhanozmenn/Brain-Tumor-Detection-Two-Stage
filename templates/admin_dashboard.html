<!DOCTYPE html>
<html lang="tr">
<head>
    <title>YÖNETİCİ PANELİ - AI Sağlık</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #f8f9fa; }
        .sidebar { min-height: 100vh; background: #2c3e50; color: white; position: fixed; width: 250px; }
        .content { margin-left: 250px; padding: 40px; }
        .stat-card { border: none; border-radius: 15px; color: white; transition: 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .nav-tabs .nav-link { color: #495057; border: none; font-weight: bold; }
        .nav-tabs .nav-link.active { color: #0d6efd; border-bottom: 3px solid #0d6efd; background: transparent; }
        .table-hover tbody tr:hover { background-color: rgba(13, 110, 253, 0.05); }
    </style>
</head>
<body>

<div class="sidebar p-4 d-flex flex-column">
    <h4 class="fw-bold mb-4"><i class="fa-solid fa-user-doctor"></i> Admin Paneli</h4>
    <div class="mb-4">
        <small class="text-white-50">YÖNETİCİ</small><br>
        <span class="fw-bold">{{ current_user.username }}</span>
    </div>

    <hr class="border-secondary">

    <a href="/" class="btn btn-outline-light w-100 mb-2 text-start border-0"><i class="fa-solid fa-house me-2"></i> Ana Sayfa</a>
    <a href="/dashboard" class="btn btn-outline-light w-100 mb-2 text-start border-0"><i class="fa-solid fa-clipboard-list me-2"></i> Kendi Taramalarım</a>

    <div class="mt-auto">
        <a href="/logout" class="btn btn-danger w-100"><i class="fa-solid fa-power-off me-2"></i> Çıkış</a>
    </div>
</div>

<div class="content">
    <h2 class="fw-bold mb-4 text-dark">Hastane Genel Durumu</h2>

    <div class="row mb-5">
        <div class="col-md-4">
            <div class="card stat-card bg-primary p-4 shadow">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0 fw-bold">{{ users|length }}</h2>
                        <span>Toplam Kullanıcı</span>
                    </div>
                    <i class="fa-solid fa-users fa-3x opacity-50"></i>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card stat-card bg-success p-4 shadow">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0 fw-bold">{{ reports|length }}</h2>
                        <span>Toplam Analiz</span>
                    </div>
                    <i class="fa-solid fa-file-medical fa-3x opacity-50"></i>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card stat-card bg-warning p-4 shadow text-dark">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0 fw-bold">Active</h2>
                        <span>Sistem Durumu</span>
                    </div>
                    <i class="fa-solid fa-server fa-3x opacity-50"></i>
                </div>
            </div>
        </div>
    </div>

    <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button">
                <i class="fa-solid fa-users"></i> Kayıtlı Kullanıcılar
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="scans-tab" data-bs-toggle="tab" data-bs-target="#scans" type="button">
                <i class="fa-solid fa-list-check"></i> Tüm Taramalar
            </button>
        </li>
    </ul>

    <div class="tab-content" id="adminTabsContent">

        <div class="tab-pane fade show active" id="users" role="tabpanel">
            <div class="card shadow-sm border-0">
                <div class="card-body p-0">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="p-3">ID</th>
                                <th>Kullanıcı Adı</th>
                                <th>Yetki</th>
                                <th>Toplam Tarama</th>
                                <th>Durum</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for u in users %}
                            <tr>
                                <td class="p-3 text-muted">#{{ u.id }}</td>
                                <td class="fw-bold">{{ u.username }}</td>
                                <td>
                                    {% if u.is_admin %}
                                        <span class="badge bg-dark">Yönetici</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Üye</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if u.reports|length > 0 %}
                                        <span class="badge bg-primary">{{ u.reports|length }} Tarama</span>
                                    {% else %}
                                        <span class="text-muted small">Henüz işlem yok</span>
                                    {% endif %}
                                </td>
                                <td><i class="fa-solid fa-circle-check text-success"></i> Aktif</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="scans" role="tabpanel">
            <div class="card shadow-sm border-0">
                <div class="card-body p-0">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-dark text-white">
                            <tr>
                                <th class="p-3">Hasta Adı</th>
                                <th>Tarih / Saat</th>
                                <th>MR Görüntüsü</th>
                                <th>Risk Sonucu</th>
                                <th>Skor</th>
                                <th>Rapor</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for report in reports %}
                            <tr>
                                <td class="p-3 fw-bold text-primary">
                                    <i class="fa-solid fa-user me-2"></i>{{ report.owner.username }}
                                </td>
                                <td>{{ report.date.strftime('%d.%m.%Y %H:%M') }}</td>
                                <td>
                                    <img src="{{ report.processed_path }}" width="60" class="rounded border shadow-sm" style="cursor:zoom-in" onclick="window.open(this.src)">
                                </td>
                                <td>
                                    {% if report.risk_score > 50 %}
                                        <span class="badge bg-danger p-2"><i class="fa-solid fa-triangle-exclamation"></i> YÜKSEK RİSK</span>
                                    {% else %}
                                        <span class="badge bg-success p-2"><i class="fa-solid fa-check"></i> TEMİZ</span>
                                    {% endif %}
                                </td>
                                <td class="fw-bold">%{{ report.risk_score }}</td>
                                <td>
                                    <a href="{{ report.pdf_path }}" download class="btn btn-sm btn-outline-dark">
                                        <i class="fa-solid fa-file-pdf"></i> PDF
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>